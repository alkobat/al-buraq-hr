# ๐ ูุฑุฌุน ุณุฑูุน: ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุชููููุงุช

## ๐ ุงูุชุดุฎูุต ุงูุณุฑูุน

### โ ููุงุฐุง ุงูุฑุณุงุฆู ูุง ุชุฑุณูุ

```
โ ุชุญูู ุจุงูุชุฑุชูุจ:
1. [ ] ูู SMTP ูุถุจูุทุ โ email_settings.php
2. [ ] ูู Master Toggle ููุนููุ โ auto_send_eval = '1'
3. [ ] ูู ุงูุฅุนุฏุงุฏ ุงููุฑุนู ููุนููุ โ settings.php
4. [ ] ุงูุธุฑ email_logs ููุฃุฎุทุงุก
```

### โ ููุงุฐุง ุชุฑุณู ุงูุฑุณุงุฆู ุฑุบู ุงูุชุนุทููุ

```
โ ุชุญูู ูู:
1. [ ] ูููุฉ auto_send_eval ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. [ ] ูู ุชู ุชุทุจูู ุงูุชุนุฏูู ุนูู EmailService.phpุ
3. [ ] ุงูุณุญ cache ุงูุฎุงุฏู
```

---

## ๐๏ธ ุงูุฅุนุฏุงุฏุงุช - ุฃูู ููุชู

| ุงูุฅุนุฏุงุฏ | ุงููููุน | ุงููููุฉ | ุงููุธููุฉ |
|---------|--------|--------|---------|
| **SMTP** | email_settings.php | ุฎุงุฏู ุงูุจุฑูุฏ | ุฃุณุงุณู - ูุทููุจ ููุฅุฑุณุงู |
| **auto_send_user** | email_settings.php | 0 ุฃู 1 | ุฑุณุงุฆู ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ |
| **auto_send_eval** | email_settings.php | 0 ุฃู 1 | ๐ Master ููุชููููุงุช |
| **evaluation_method** | settings.php | 3 ุฎูุงุฑุงุช | ุทุฑููุฉ ุงูุญุณุงุจ |
| **ุฅุนุฏุงุฏุงุช ุงูุทุฑู** | settings.php | ุญุณุจ ุงูุทุฑููุฉ | ูุชู ูุฑุณู |

---

## ๐๏ธ ุงูููุงุชูุญ ุงูุฑุฆูุณูุฉ

### ๐ข SMTP (ูุฌุจ ุถุจุทู ุฃููุงู)
```
email_settings.php โ ุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู (SMTP)
โโ smtp_host      = mail.buraq.aero
โโ smtp_port      = 465
โโ smtp_user      = hr@buraq.aero
โโ smtp_pass      = โขโขโขโขโขโขโขโข
โโ smtp_secure    = ssl
โโ smtp_from_email = hr@buraq.aero
โโ smtp_from_name  = ูุธุงู ุชูููู ุงูุฃุฏุงุก
```

### ๐ต Master Toggle ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
```
email_settings.php โ auto_send_user
โ = '1' โ ูุฑุณู ูููุฉ ุงููุฑูุฑ ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
โ = ''  โ ูุง ูุฑุณู
```

### ๐ด Master Toggle ููุชููููุงุช (ุงูุฌุฏูุฏ)
```
email_settings.php โ auto_send_eval
โ = '1' โ ููุนูู ูุธุงู ุงูุชููููุงุช (ุซู ููุญุต ุงูุชูุงุตูู)
โ = ''  โ ูููู ูู ุฑุณุงุฆู ุงูุชููููุงุช ููุฑุงู โ๏ธ
```

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุชููููุงุช ุงูุชูุตูููุฉ

### ุงูุทุฑููุฉ โ - ุชูููู ุงููุฏูุฑ ููุท
```
settings.php
โโ evaluation_method = 'manager_only'
โโ evaluation_email_manager_only_enabled
   โ = '1' โ ูุฑุณู ุนูุฏ ุชูููู ุงููุฏูุฑ
   โ = '0' โ ูุง ูุฑุณู
```

### ุงูุทุฑููุฉ โก - ุงุณุชุฎุฏุงู ุงููุชุงุญ
```
settings.php
โโ evaluation_method = 'available_score'
โโ evaluation_email_available_score_mode
   โโ 'manager_only'    โ ููุท ุนูุฏ ุงููุฏูุฑ
   โโ 'supervisor_only' โ ููุท ุนูุฏ ุงููุดุฑู
   โโ 'any'            โ ุนูุฏ ุฃู ููููุง
   โโ 'both'           โ ุนูุฏ ุงูุชูุงู ุงูุงุซููู
```

### ุงูุทุฑููุฉ โข - ูุชูุณุท ุงูุงุซููู
```
settings.php
โโ evaluation_method = 'average_complete'
โโ evaluation_email_average_complete_mode
   โโ 'both_only'                โ ุฑุณุงูุฉ ูุงุญุฏุฉ ุนูุฏ ุงูุงูุชูุงู
   โโ 'each_plus_final'          โ ุฑุณุงูุฉ ููู + ููุงุฆูุฉ
   โโ 'waiting_supervisor_plus_final' โ ุชูุจูู + ููุงุฆูุฉ
```

---

## ๐ ุชุฏูู ุงููุฑุงุฑ

```
ูู ูุตู ุฅุดุนุงุฑ ุชููููุ
        โ
        โโโ ูุง โ ุชุงุจุน ููุฃุณูู
        โโโ ูุนู โ ูู ุดูุก ูุนูู โ

ูุญุต 1: SMTP
โโโ ูุนุทูุ โ ูุนููู ูู email_settings.php
โโโ ููุนูู โ ุชุงุจุน

ูุญุต 2: Master Toggle (auto_send_eval)
โโโ = '' โ ูุนููู! (email_settings.php)
โโโ = '1' โ ุชุงุจุน

ูุญุต 3: ุทุฑููุฉ ุงูุญุณุงุจ
โโโ ุชุญูู ูู evaluation_method ูู settings.php
โโโ ูุง ูู ุงูุทุฑููุฉ ุงููุฎุชุงุฑุฉุ

ูุญุต 4: ุงูุฅุนุฏุงุฏ ุงููุฑุนู
โโโ ูู ุงูุฅุนุฏุงุฏ ุงูุฎุงุต ุจุงูุทุฑููุฉ ููุนููุ
โโโ ูุนูุ ุชุงุจุนุ ูุงุ ูุนููู

ูุญุต 5: ุงูุดุฑูุท
โโโ ูู ุงูููุธู ูู ุฑุฆูุณ ูุจุงุดุฑุ
โโโ ูู ููููุ (ูุฏูุฑ/ูุดุฑู)
โโโ ูู ุงุณุชููู ุดุฑูุท ุงูุฅุฑุณุงู ููุทุฑููุฉุ

ุชุญูู ูู email_logs
โโโ ุงูุธุฑ status ู error_message
```

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงูุดุงุฆุนุฉ

### 1. ุฅููุงู ุทูุงุฑุฆ ุณุฑูุน
```bash
ุงูููุช: 10 ุซูุงูู
ุงูุฎุทูุงุช:
1. email_settings.php
2. ุนุทูู auto_send_eval
3. ุงุญูุธ
โ ุฌููุน ุฑุณุงุฆู ุงูุชููููุงุช ุชูููุช
```

### 2. ุฅุนุฏุงุฏ ูุธุงู ุฌุฏูุฏ
```bash
ุงูุชุฑุชูุจ:
1. ุถุจุท SMTP ุฃููุงู (email_settings.php)
2. ุงุฎุชุจุฑ ุจุฅุฑุณุงู ูููุณู
3. ุงุถุจุท evaluation_method (settings.php)
4. ุงุถุจุท ุงูุฅุนุฏุงุฏ ุงููุฑุนู
5. Master Toggle ูุง ูุฒุงู OFF
6. ุงุฎุชุจุฑ ุนูู ููุธู ูููู
7. ุชุญูู ูู email_logs
8. ูุนูู Master Toggle
โ ุฌุงูุฒ ููุฅูุชุงุฌ
```

### 3. ุชูููู ุนุฏุฏ ุงูุฑุณุงุฆู
```bash
ุงููุดููุฉ: ูุซุฑุฉ ุงูุดูุงูู ูู ุงูููุธููู
ุงูุญู:
1. settings.php
2. ุฅุฐุง ุงูุทุฑููุฉ โก ุฃู โข:
   ุบููุฑ ุงูุฅุนุฏุงุฏ ุฅูู:
   - 'both' ููุทุฑููุฉ โก
   - 'both_only' ููุทุฑููุฉ โข
โ ุฑุณุงูุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ุงูุงูุชูุงู
```

---

## ๐ ุฌุฏูู ุงููุฑุงุฑุงุช ุงููุจุณุท

| Master | ุงูุทุฑููุฉ | ุงูุฅุนุฏุงุฏ | ุงููุชูุฌุฉ |
|--------|---------|---------|---------|
| โ | ุฃู | ุฃู | ูุง ูุฑุณู |
| โ | โ | โ | ูุง ูุฑุณู |
| โ | โ | โ | ูุฑุณู ุนูุฏ ุงููุฏูุฑ |
| โ | โก | any | ูุฑุณู ุนูุฏ ุฃู ููููุง |
| โ | โก | both | ูุฑุณู ุนูุฏ ุงูุงุซููู |
| โ | โข | both_only | ุฑุณุงูุฉ ููุงุฆูุฉ ููุท |
| โ | โข | each_plus_final | ุฑุณุงูุฉ ููู + ููุงุฆูุฉ |

---

## ๐ง SQL ูููุญุต ุงูุณุฑูุน

### ูุญุต ูููุฉ Master Toggle
```sql
SELECT `key`, `value` 
FROM system_settings 
WHERE `key` = 'auto_send_eval';

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ: '1' ููุชูุนููุ '' ููุชุนุทูู
```

### ูุญุต ุขุฎุฑ ุงูุฑุณุงุฆู ุงููุฑุณูุฉ
```sql
SELECT * FROM email_logs 
ORDER BY created_at DESC 
LIMIT 10;
```

### ูุญุต ุงูุฃุฎุทุงุก ููุท
```sql
SELECT employee_id, subject, error_message, created_at
FROM email_logs 
WHERE status = 'failure'
ORDER BY created_at DESC 
LIMIT 20;
```

### ูุญุต ุฑุณุงุฆู ููุธู ูุนูู
```sql
SELECT subject, status, created_at, error_message
FROM email_logs 
WHERE employee_id = ? 
ORDER BY created_at DESC;
```

---

## ๐จ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง

### 1. SMTP authentication failed
```
ุงูุณุจุจ: ุฎุทุฃ ูู ุงุณู ุงููุณุชุฎุฏู/ูููุฉ ุงููุฑูุฑ
ุงูุญู:
1. ุชุญูู ูู smtp_user ู smtp_pass
2. ุงุฎุชุจุฑ ุชุณุฌูู ุงูุฏุฎูู ูุฏููุงู
3. ุชุฃูุฏ ูู smtp_secure (SSL/TLS)
```

### 2. Connection timed out
```
ุงูุณุจุจ: ูููุฐ (Port) ุฎุงุทุฆ ุฃู ูุญุธูุฑ
ุงูุญู:
1. ุชุญูู ูู smtp_port (465 ูู SSLุ 587 ูู TLS)
2. ุชุญูู ูู firewall
3. ุฌุฑุจ ูููุฐ ุขุฎุฑ
```

### 3. Invalid email address
```
ุงูุณุจุจ: ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุธู ุบูุฑ ุตุงูุญ
ุงูุญู:
1. ุชุญูู ูู ุฌุฏูู users
2. ุตุญุญ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ุฃุนุฏ ุงููุญุงููุฉ
```

### 4. ูุง ูุธูุฑ ูู email_logs
```
ุงูุณุจุจ ุงููุญุชูู: Master Toggle ูุนุทู
ุงูุญู:
1. ุชุญูู ูู auto_send_eval
2. ูุฌุจ ุฃู ูููู = '1'
3. ุฅุฐุง ูุงู ูุฐููุ ุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช ุงููุฑุนูุฉ
```

---

## ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### email_settings.php
```
ุงูุฃูุณุงู:
โโ ุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู (SMTP) โ ุฃุณุงุณู
โโ ุงูุฃุชูุชุฉ (Automation)
โ  โโ auto_send_user โ ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
โ  โโ auto_send_eval โ Master ููุชููููุงุช ๐
โโ ููุงูุจ ุงูุฑุณุงุฆู โ ุงูุชุฎุตูุต
```

### settings.php
```
ุงูุฃูุณุงู ุฐุงุช ุงูุตูุฉ:
โโ ุทุฑููุฉ ุงุญุชุณุงุจ ุงูุชููููุงุช โ 3 ุฎูุงุฑุงุช
โโ ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ููุชููููุงุช โ ุชูุตูููุฉ
   โโ ููุทุฑููุฉ โ
   โโ ููุทุฑููุฉ โก
   โโ ููุทุฑููุฉ โข
```

---

## ๐ก ูุตุงุฆุญ ูููุณุคูู

### โ ุฃูุถู ุงูููุงุฑุณุงุช
1. **ุงุฎุชุจุฑ ุฏุงุฆูุงู** ูุจู ุงูุชูุนูู ููุฌููุน
2. **ุฑุงูุจ email_logs** ุจุนุฏ ุฃู ุชุบููุฑ
3. **ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ** ูุจู ุงูุชุนุฏููุงุช
4. **ูุซูู ุงูุชุบููุฑุงุช** ูู activity_logs
5. **ุงุณุชุฎุฏู Master Toggle** ููุฅููุงู ุงูุณุฑูุน

### โ ุชุฌูุจ
1. ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช ุฃุซูุงุก ุฐุฑูุฉ ุงูุนูู
2. ุชูุนูู ูู ุดูุก ูุฑุฉ ูุงุญุฏุฉ
3. ุฅููุงู ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก
4. ุชุนุทูู SMTP ุจุฏูุงู ูู Master Toggle
5. ูุณูุงู ุฅุนูุงู ุงููุณุชุฎุฏููู ุจุงูุชุบููุฑุงุช

---

## ๐ ุงูุฏุนู

### ูููุฒูุฏ ูู ุงููุนูููุงุช:
- **ุงูุชุญููู ุงููุงูู:** `analysis-mail-settings-conflict.md`
- **ุงููุฎุทุทุงุช:** `mail-settings-flowchart.md`
- **ุงูุชูุตูุงุช:** `RECOMMENDATIONS-AR.md`
- **ูุฐุง ุงููุฑุฌุน:** `QUICK-REFERENCE.md`

### ุฃุฑูุงู ูููุฉ:
- email_logs โ ุณุฌู ุงูุฅุฑุณุงู
- activity_logs โ ุณุฌู ุงููุดุงุท
- system_settings โ ุฌููุน ุงูุฅุนุฏุงุฏุงุช

---

## ๐ ุฅุดุงุฑุงุช ูุฑุฌุนูุฉ ุณุฑูุนุฉ

```
ุงูุตูุญุฉ                        ุงูุณุทุฑ     ุงููุธููุฉ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
app/core/EmailService.php     33+      handleEvaluationSubmitted()
app/core/EmailService.php     353      getSetting()
public/admin/email_settings.php 75-78  ูุงุฌูุฉ auto_send_eval
public/admin/settings.php     130-160  ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ
public/manager/evaluate.php  378-384  ุงุณุชุฏุนุงุก EmailService
public/supervisor/evaluate.php 236-242 ุงุณุชุฏุนุงุก EmailService
al_b.sql                      393      auto_send_eval ูู DB
```

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2024-12-13  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุงุณุชุฎุฏุงู โ

**๐ ุงุญูุธ ูุฐู ุงูุตูุญุฉ ููุฑุฌุน ุณุฑูุน!**
