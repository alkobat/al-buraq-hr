# ุชุญููู ุดุงูู ูุธุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ๐ง
**ูุธุงู ุชูููู ุงูุฃุฏุงุก - ุดุฑูุฉ ุงูุจุฑุงู ููููู ุงูุฌูู**  
**ุงูุชุงุฑูุฎ:** 2024-12-13 | **ุงูุฅุตุฏุงุฑ:** 1.0 - ุจุนุฏ ุฅุตูุงุญ PHPMailer | **ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช
1. [ููุฎุต ุชูููุฐู](#ููุฎุต-ุชูููุฐู)
2. [ุฎุฑูุทุฉ ูุงููุฉ ูููุงุท ุงูุฅุฑุณุงู](#ุฎุฑูุทุฉ-ููุงุท-ุงูุฅุฑุณุงู)
3. [ุงูุฃุญุฏุงุซ ูุงูุดุฑูุท](#ุงูุฃุญุฏุงุซ-ูุงูุดุฑูุท)
4. [ุงูุฅุนุฏุงุฏุงุช ูุงูููุงุชูุญ](#ุงูุฅุนุฏุงุฏุงุช-ูุงูููุงุชูุญ)
5. [ุญุงูุฉ SMTP](#ุญุงูุฉ-smtp)
6. [ุงูุชุถุงุฑุจุงุช ูุงููุดุงูู](#ุงูุชุถุงุฑุจุงุช-ูุงููุดุงูู)
7. [ุงูุชูุงูู ูุน ุงูุทุฑู ุงูุซูุงุซ](#ุงูุชูุงูู-ูุน-ุงูุทุฑู-ุงูุซูุงุซ)
8. [ุงูุชูุตูุงุช ูุงูุญููู](#ุงูุชูุตูุงุช-ูุงูุญููู)

---

## ููุฎุต ุชูููุฐู

ูุธุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุนุชูุฏ ุนูู **PHPMailer** ูุฅุฑุณุงู ุงูุฑุณุงุฆู ุจุดูู ุขูู. ูุฏุนู:

- โ **3 ุทุฑู ุงุญุชุณุงุจ ุชููููุงุช** ูุฎุชููุฉ ูุน ูุตูุต ุจุฑูุฏูุฉ ูุฎุตุตุฉ
- โ **Master Toggle** ูุชูุนูู/ุฅููุงู ุงูุฅุฑุณุงู ุงูุขูู
- โ **ุฅุฑุณุงู ูุดุฑูุท** ุจูุงุกู ุนูู ุญุงูุฉ ุงูุชูููู
- โ **ุฑุณุงุฆู ุชุฐููุฑูุฉ** ุขููุฉ
- โ **ุฅุฑุณุงู ุฌูุงุนู** ูู ูุจู HR
- โ **ุณุฌู ุดุงูู** ูุฌููุน ุงูุฑุณุงุฆู

**ุงูุญุงูุฉ ุงูุญุงููุฉ:** โ **ุตุญูุญ - ูุง ุชูุฌุฏ ูุดุงูู ุญุฑุฌุฉ**

---

## ุฎุฑูุทุฉ ููุงุท ุงูุฅุฑุณุงู

### 1๏ธโฃ ููุงุท ุงูุฅุฑุณุงู ุงูุฑุฆูุณูุฉ (7 ููุงุท)

| # | ุงูููู | ุงูุณุทุฑ | ุงูุญุฏุซ | ุงูุบุฑุถ |
|---|------|-------|-------|--------|
| 1 | `/app/core/EmailService.php` | 40-119 | ูุญุฑู ุงูุชูุฑูุฑ | **ุงููุญุฑู ุงูุฑุฆูุณู** - ููุฑุฑ ููุน ุงูุฑุณุงูุฉ |
| 2 | `/public/manager/evaluate.php` | 387-394 | ุฅุฑุณุงู ูู ูุฏูุฑ | ุงุณุชุฏุนุงุก EmailService |
| 3 | `/public/supervisor/evaluate.php` | 245-252 | ุฅุฑุณุงู ูู ูุดุฑู | ุงุณุชุฏุนุงุก EmailService |
| 4 | `/public/admin/bulk_email.php` | 30-82 | ุฅุฑุณุงู ุฌูุงุนู | ุฑุณุงุฆู ูุฌููุนุงุช |
| 5 | `/public/evaluator/bulk_email.php` | 39-88 | ุฅุฑุณุงู ูู HR | ุฑุณุงุฆู ูุฎุตุตุฉ |
| 6 | `/public/admin/reminders.php` | 96-129 | ุชุฐููุฑุงุช ุขููุฉ | Cron jobs |
| 7 | `/public/admin/users.php` | ~200 | ุฅุถุงูุฉ ูุณุชุฎุฏู | ุชุฑุญูุจ + ูููุฉ ุณุฑ |

### 2๏ธโฃ ุงูุฑุณุงุฆู ุงููุดุฑูุทุฉ

| ุงูุฏุงูุฉ | ุงูููู | ุงูุณุทูุฑ | ุงูุดุฑุท |
|--------|-------|--------|--------|
| `sendEvaluationNotification()` | EmailService | 125-134 | ุชู ุชูููู ููุธู |
| `sendAvailableScoreNotification()` | EmailService | 140-167 | ุชูููู ุฌุฏูุฏ ูุชุงุญ |
| `sendCompleteEvaluationNotification()` | EmailService | 173-206 | ุงูุชูู ุงูุชูููู |
| `sendWaitingForSupervisorNotification()` | EmailService | 208-232 | ุงูุชุธุงุฑ ูุดุฑู |
| `sendWaitingForManagerNotification()` | EmailService | 234-258 | ุงูุชุธุงุฑ ูุฏูุฑ |

---

## ุงูุฃุญุฏุงุซ ูุงูุดุฑูุท

### ๐ ุฏูุฑุฉ ุงูุญูุงุฉ ุงููุงููุฉ

```
ุชูุฏูู ุงูุชูููู
    โ
ูุญุต Master Toggle: auto_send_eval == '1'
    โ
ุฌูุจ ุทุฑููุฉ ุงูุญุณุงุจ (method)
    โ
ุงูุชูุฑูุน ุญุณุจ ุงูุทุฑููุฉ:

1. manager_only:
   โโ ุชู ูู ูุฏูุฑุ โ ุฃุฑุณู ุจุฑูุฏ โ
   
2. available_score:
   โโ mode='manager_only': ุฃุฑุณู ูู ูุฏูุฑ
   โโ mode='supervisor_only': ุฃุฑุณู ูู ูุดุฑู
   โโ mode='any': ุฃุฑุณู ูู ุฃู โ
   โโ mode='both': ุฃุฑุณู ุนูุฏ ุงูุชูุงู ุงูุงุซููู
   
3. average_complete:
   โโ ุจุฏูู ุฑุฆูุณ: ุฃุฑุณู ูู ูุฏูุฑ ููุท
   โโ ูุน ุฑุฆูุณ:
      โโ mode='both_only': ููุท ุนูุฏ ุงูุชูุงู
      โโ mode='each_plus_final': ุนูุฏ ูู + ุงูุชูุงู
      โโ mode='waiting_supervisor_plus_final': ุงูุชุธุงุฑ + ุงูุชูุงู

ุชุณุฌูู ูู email_logs
    โ
ุงูููุงูุฉ โ
```

### โ๏ธ ุงูุดุฑูุท ุงูููุตูุฉ

**Master Toggle (ุงูุฃุณุงุณู):**
```php
// line 43 ูู EmailService.php
if ($this->getSetting('auto_send_eval', '0') !== '1') {
    return; // ุฅููุงู ููุฑู
}
```

---

## ุงูุฅุนุฏุงุฏุงุช ูุงูููุงุชูุญ

### SMTP Settings
| ุงูููุชุงุญ | ุงููููุน | ุงูุบุฑุถ |
|--------|--------|--------|
| `smtp_host` | system_settings | ุฎุงุฏู ุงูุจุฑูุฏ |
| `smtp_port` | system_settings | ูููุฐ (587/465) |
| `smtp_user` | system_settings | ุงุณู ุงููุณุชุฎุฏู |
| `smtp_pass` | system_settings | ูููุฉ ุงููุฑูุฑ |
| `smtp_secure` | system_settings | TLS ุฃู SSL |
| `smtp_from_email` | system_settings | ุจุฑูุฏ ุงูุฅุฑุณุงู |
| `smtp_from_name` | system_settings | ุงุณู ุงููุฑุณู |

**ุงููููุน:** `/public/admin/email_settings.php` (ุงูุฃุณุทุฑ 57-90)

### Control Keys
| ุงูููุชุงุญ | ุงูููู | ุงูุงูุชุฑุงุถู | ุงูุบุฑุถ |
|--------|-------|-----------|--------|
| `auto_send_eval` | 0/1 | 0 | ุชูุนูู ุฌููุน ุงูุฑุณุงุฆู |
| `auto_send_user` | 0/1 | 0 | ุจุฑูุฏ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ |
| `evaluation_method` | 3 options | average_complete | ุทุฑููุฉ ุงูุญุณุงุจ |

### Method-Specific Settings

**manager_only:**
```
Key: evaluation_email_manager_only_enabled
Values: 0 (ูุนุทู) / 1 (ููุนู)
Default: 0
```

**available_score:**
```
Key: evaluation_email_available_score_mode
Values: 'manager_only' / 'supervisor_only' / 'any' / 'both'
Default: 'any'
```

**average_complete:**
```
Key: evaluation_email_average_complete_mode
Values: 'both_only' / 'each_plus_final' / 'waiting_supervisor_plus_final'
Default: 'waiting_supervisor_plus_final'
```

---

## ุญุงูุฉ SMTP

### โ ุงูุญุงูุฉ ุงูุญุงููุฉ

**ุงูููููุงุช:**
- โ PHPMailer ูุซุจุช (`vendor/autoload.php`)
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
- โ ุชุดููุฑ SMTP ุขูู (TLS/SSL)
- โ ุณุฌู ูุงูู ููุฃุฎุทุงุก
- โ๏ธ ุฅุนุฏุงุฏุงุช SMTP ุชุญุชุงุฌ ุชุญูู

**ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:**
```php
try {
    $mail->send();
    return true;
} catch (Throwable $e) {
    error_log('Mailer error: ' . $e->getMessage());
    return false;
}
```

**ููุงุท ุงููุญุต:**
| ููุทุฉ | ุงูุญุงูุฉ | ุงูููุงุญุธุงุช |
|------|--------|----------|
| PHPMailer ูุซุจุช | โ | vendor/autoload.php ููุฌูุฏ |
| ุฅุนุฏุงุฏุงุช SMTP ุตุญูุญุฉ | โ๏ธ | ูุญุชุงุฌ ูุญุต ูุฏูู |
| ุงูุงุชุตุงู ุงูุดุจูู | โ๏ธ | ูุญุชุงุฌ ุงุฎุชุจุงุฑ |
| ุณุฌู ุงูุฃุฎุทุงุก | โ | ุฌููุน ุงูุฃุฎุทุงุก ูุณุฌูุฉ |

---

## ุงูุชุถุงุฑุจุงุช ูุงููุดุงูู

### โ ุงููุชูุฌุฉ: ูุง ุชูุฌุฏ ูุดุงูู ุญุฑุฌุฉ

#### โ ููุงุท ุฅูุฌุงุจูุฉ:

**1. ููุน ุงูุชูุฑุงุฑ:**
```php
// line 175 ูู EmailService.php
if ($this->hasSuccessfulEmail($employeeId, $cycleId, self::TYPE_FINAL_COMPLETE)) {
    return; // ูุง ูุฑุณู ุฑุณุงูุฉ ููุฑุฑุฉ
}
```

**2. Master Toggle ูุนูู ุจุดูู ุตุญูุญ:**
```php
// line 43 - ูุญุต ุฃูู ุดูุก
if ($this->getSetting('auto_send_eval', '0') !== '1') {
    return;
}
```

**3. ุณุฌู ุดุงูู:**
- ุฌููุน ุงูุฑุณุงุฆู ูุณุฌูุฉ ูู `email_logs`
- ูุชุถูู: ุงูููุนุ ุงูุญุงูุฉุ ุงูุฎุทุฃุ ุงูุจูุงูุงุช ุงููุตููุฉ

#### โ ูุง ููุฌุฏ:
- โ ุจุฑูุฏ ููุฑุณู ูุฑุชูู
- โ ุดุฑูุท ูุชูุงูุถุฉ
- โ ุฅุนุฏุงุฏุงุช ุชูุบู ุจุนุถูุง
- โ ูุดุงูู ููุทููุฉ

---

## ุงูุชูุงูู ูุน ุงูุทุฑู ุงูุซูุงุซ

### ุฌุฏูู ุงูุชูุงูู ุงููุงูู

| ุงูููุฒุฉ | manager_only | available_score | average_complete |
|--------|---|---|---|
| **ุงูุฏุนู** | โ | โ | โ (ุงูุชุฑุงุถู) |
| **ุฑุณุงูุฉ ุงูุชูููู** | โ | โ | โ |
| **ุฑุณุงูุฉ ุงูุงูุชุธุงุฑ** | โ | โ | โ |
| **ุฑุณุงูุฉ ุงูุงูุชูุงู** | โ | (ูุดุฑูุท) | โ |
| **ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุฑุณุงุฆู** | 0 | 0 | 0 |
| **ุงูุญุฏ ุงูุฃูุตู ูู ุงูุฑุณุงุฆู** | 1 | 2 | 3 |
| **ุงูุญุงูุงุช:** | complete | partial/complete | incomplete/complete |

### ุฃูุซูุฉ ุงูุฑุณุงุฆู

**manager_only:**
```
ุนูุฏ ุชูููู ูุฏูุฑ: ุจุฑูุฏ โ
ุนูุฏ ุชูููู ูุดุฑู: ูุง ุดูุก โ
```

**available_score (mode='any'):**
```
ุนูุฏ ุชูููู ูุฏูุฑ: ุจุฑูุฏ (status: partial)
ุนูุฏ ุชูููู ูุดุฑู: ุจุฑูุฏ (status: partial)
ุนูุฏ ูููููุง: ุจุฑูุฏ (status: complete)
```

**average_complete (mode='waiting_supervisor_plus_final'):**
```
ุจุฏูู ุฑุฆูุณ: ุจุฑูุฏ ูู ูุฏูุฑ ููุท
ูุน ุฑุฆูุณ:
  ุนูุฏ ูุฏูุฑ: "ุจุงูุชุธุงุฑ ุงููุดุฑู" โ
  ุนูุฏ ุงูุชูุงู: "ุชู ุงูุงูุชูุงู - ุงููุชูุฌุฉ: 82/100" โ
```

---

## ุงูุชูุตูุงุช ูุงูุญููู

### ๐ฏ ุฃููููุงุช ุงูุนูู

#### โ๏ธ ุฃููููุฉ ุนุงููุฉ:

1. **ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช SMTP:**
   - ุชุฃูุฏ: `smtp_host` ุตุญูุญ
   - ุชุฃูุฏ: `smtp_port` ุตุญูุญ (587 ููู TLSุ 465 ููู SSL)
   - ุชุฃูุฏ: ุงูุจุฑูุฏ ูุตุฑุญ ุจู

2. **ุชูุนูู Master Toggle:**
   - ุงุฐูุจ: `/public/admin/email_settings.php`
   - ุนููู: `auto_send_eval = 1`

3. **ุงุฎุชุจุงุฑ ุดุงูู:**
   - ุงุฎุชุจุฑ ูู ุทุฑููุฉ ุงุญุชุณุงุจ
   - ุงุฎุชุจุฑ ุฅุฑุณุงู ุฌูุงุนู
   - ุฑุงูุจ `email_logs`

#### โน๏ธ ุฃููููุฉ ูุชูุณุทุฉ:

4. **ุชุญุณูู ุงูุณุฌู:**
   - ุฃุถู ุตูุญุฉ ุนุฑุถ email_logs
   - ุงุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุฅุฑุณุงู

5. **ุฅุถุงูุฉ ุงุฎุชุจุงุฑ SMTP:**
   - ุฒุฑ "ุงุฎุชุจุฑ ุงูุงุชุตุงู" ูู email_settings

---

## ๐ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

**๐ข ุงูุญุงูุฉ: ููุชุงุฒ - ุฌุงูุฒ ููุฅูุชุงุฌ**

| ุงููุนูุงุฑ | ุงููุชูุฌุฉ |
|--------|--------|
| ุงูุฃูุงู | โ ููุชุงุฒ |
| ุงูููุซูููุฉ | โ ููุชุงุฒ |
| ุงููุฑููุฉ | โ ููุชุงุฒ |
| ุงูุฃุฏุงุก | โ ุฌูุฏ |
| ุงูุชูุซูู | โ๏ธ ูุฐุง ุงูุชูุฑูุฑ ูููุฑู |
| ุงูุงุฎุชุจุงุฑ | โ๏ธ ูุญุชุงุฌ ูุจู ุงูุฅุทูุงู |

**ุงููุตุงุฆุญ:**
1. โ ุงูุชุญูู ูู SMTP settings
2. โ ุงุฎุชุจุงุฑ ุงูุฅุฑุณุงู ูุฏูููุง
3. โ ุชูุนูู auto_send_eval
4. โ ุงููุฑุงูุจุฉ ุงููุณุชูุฑุฉ

---

## ๐ ููุงุญู

### ุงููููุงุช ุงููููุฉ:
```
/app/core/EmailService.php    โ ุงููุญุฑู ุงูุฑุฆูุณู
/app/core/Mailer.php          โ ูุธููุฉ ุงูุฅุฑุณุงู
/public/admin/email_settings.php โ ุฅุนุฏุงุฏุงุช SMTP
/public/admin/settings.php    โ ุฅุนุฏุงุฏุงุช ุงูุทุฑู
```

### ุงูุฌุฏุงูู ุงููููุฉ:
```sql
SELECT * FROM system_settings WHERE `key` LIKE 'smtp_%' OR `key` LIKE 'auto_send%';
SELECT * FROM email_logs ORDER BY created_at DESC LIMIT 50;
SELECT email_type, status, COUNT(*) FROM email_logs GROUP BY email_type, status;
```

---

**ูููุฒูุฏ ูู ุงูุชูุงุตูู:** ุงูุฑุฃ ุงููููุงุช ุงูุฃุฎุฑู:
- ๐ `EMAIL_SYSTEM_SUMMARY.md` - ููุฎุต ุณุฑูุน
- ๐ก `EMAIL_SYSTEM_EXAMPLES.md` - ุฃูุซูุฉ ุนูููุฉ
- ๐ `EMAIL_DOCUMENTATION_INDEX.md` - ููุฑุณ ุดุงูู

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2024-12-13 | **ุงูุฅุตุฏุงุฑ:** 1.0 โ
