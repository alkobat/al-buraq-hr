# Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ© - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ğŸ“§

---

## ğŸ¯ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: Ø´Ø±ÙƒØ© ØµØºÙŠØ±Ø© (50 Ù…ÙˆØ¸Ù)

**Ø§Ù„ÙˆØ¶Ø¹:**
- Ù…Ø¯ÙŠØ± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· (Ø§Ù„Ø±Ø¦ÙŠØ³)
- Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±ÙÙŠÙ†
- ÙŠØ±ÙŠØ¯ÙˆÙ† Ø¨Ø±ÙŠØ¯ Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…

**Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡:**
```
Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: manager_only
evaluation_email_manager_only_enabled: 1 (Ù…ÙØ¹Ù„)
auto_send_eval: 1 (Ù…ÙØ¹Ù„)

Ø§Ù„Ù†ØªÙŠØ¬Ø©:
âœ“ Ø¨Ø±ÙŠØ¯ ÙˆØ§Ø­Ø¯ Ø¹Ù†Ø¯ ØªÙ‚ÙŠÙŠÙ… ÙƒÙ„ Ù…ÙˆØ¸Ù
âœ“ Ø¨Ø³ÙŠØ· ÙˆÙØ¹Ø§Ù„
âœ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø¹Ù‚Ø¯Ø©
```

---

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø´Ø±ÙƒØ© Ù…ØªÙˆØ³Ø·Ø© (200 Ù…ÙˆØ¸Ù)

**Ø§Ù„ÙˆØ¶Ø¹:**
- Ø¹Ø¯Ø© Ù…Ø¯Ø±Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø§Øª
- Ù…Ø´Ø±ÙÙŠÙ† Ù…Ø¨Ø§Ø´Ø±ÙŠÙ†
- ÙŠØ±ÙŠØ¯ÙˆÙ† Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø£ÙŠ ØªÙ‚ÙŠÙŠÙ…

**Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡:**
```
Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: available_score
evaluation_email_available_score_mode: 'any' (Ø£ÙŠ ØªÙ‚ÙŠÙŠÙ…)
auto_send_eval: 1 (Ù…ÙØ¹Ù„)

Ø§Ù„Ù†ØªÙŠØ¬Ø©:
âœ“ Ø¨Ø±ÙŠØ¯ Ø¹Ù†Ø¯ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯ÙŠØ±
âœ“ Ø¨Ø±ÙŠØ¯ Ø¹Ù†Ø¯ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø´Ø±Ù
âœ“ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ØªÙŠØ¬ØªÙŠÙ† Ø¥Ø°Ø§ Ù‚ÙŠÙ…Ø§ Ù…Ø¹Ø§Ù‹
âœ“ Ù…Ø±Ù† ÙˆØ´Ø§Ù…Ù„
```

---

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: Ø´Ø±ÙƒØ© ÙƒØ¨ÙŠØ±Ø© (1000+ Ù…ÙˆØ¸Ù)

**Ø§Ù„ÙˆØ¶Ø¹:**
- Ù‡ÙŠÙƒÙ„ ØªÙ†Ø¸ÙŠÙ…ÙŠ Ù…Ø¹Ù‚Ø¯
- ÙƒÙ„ Ù…ÙˆØ¸Ù Ù„Ù‡ Ù…Ø´Ø±Ù Ù…Ø¨Ø§Ø´Ø± ÙˆÙ…Ø¯ÙŠØ± Ø¥Ø¯Ø§Ø±Ø©
- ÙŠØ±ÙŠØ¯ÙˆÙ† Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„

**Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡:**
```
Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: average_complete (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ)
evaluation_email_average_complete_mode: 'waiting_supervisor_plus_final'
auto_send_eval: 1 (Ù…ÙØ¹Ù„)

Ø§Ù„Ù†ØªÙŠØ¬Ø©:
âœ“ Ø¨Ø±ÙŠØ¯ "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù" Ø¹Ù†Ø¯ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯ÙŠØ±
âœ“ ÙŠØ¯ÙØ¹ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ù„Ù„Ø¹Ù…Ù„ Ø£Ø³Ø±Ø¹
âœ“ Ø¨Ø±ÙŠØ¯ "Ø§ÙƒØªÙ…Ù„" Ù…Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
âœ“ Ù…Ø±Ø§Ù‚Ø¨Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¹Ù…Ù„ÙŠØ©
```

---

## ğŸ’¾ Ø£Ù…Ø«Ù„Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### 1ï¸âƒ£ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:

```sql
-- Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯
SELECT `key`, `value` FROM system_settings 
WHERE `key` LIKE 'smtp_%' 
   OR `key` LIKE 'auto_send%' 
   OR `key` = 'evaluation_method'
   OR `key` LIKE 'evaluation_email%';

-- Ø§Ù„Ù†ØªÙŠØ¬Ø©:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ key                                    â”‚ value           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ smtp_host                              â”‚ smtp.gmail.com  â”‚
â”‚ smtp_port                              â”‚ 587             â”‚
â”‚ smtp_user                              â”‚ hr@company.com  â”‚
â”‚ smtp_pass                              â”‚ ****            â”‚
â”‚ smtp_secure                            â”‚ tls             â”‚
â”‚ smtp_from_email                        â”‚ hr@company.com  â”‚
â”‚ smtp_from_name                         â”‚ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© â”‚
â”‚ auto_send_eval                         â”‚ 1               â”‚
â”‚ auto_send_user                         â”‚ 1               â”‚
â”‚ evaluation_method                      â”‚ average_completeâ”‚
â”‚ evaluation_email_manager_only_enabled  â”‚ 0               â”‚
â”‚ evaluation_email_available_score_mode  â”‚ any             â”‚
â”‚ evaluation_email_average_complete_mode â”‚ waiting_+_final â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ Ø³Ø¬Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ (Email Logs):

```sql
-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø±Ø³Ù„Ø©
SELECT id, employee_id, to_email, email_type, status, 
       error_message, created_at
FROM email_logs 
ORDER BY created_at DESC 
LIMIT 10;

-- Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ù…Ø«Ø§Ù„):
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ employee_id    â”‚ to_email         â”‚ email_type       â”‚ status â”‚ created_at  â”‚
â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 42  â”‚ 15 (Ø£Ø­Ù…Ø¯)      â”‚ ahmad@mail.com   â”‚ final_complete   â”‚ successâ”‚ 2024-12-13  â”‚
â”‚ 41  â”‚ 15 (Ø£Ø­Ù…Ø¯)      â”‚ ahmad@mail.com   â”‚ waiting_supervisorâ”‚successâ”‚ 2024-12-13  â”‚
â”‚ 40  â”‚ 16 (ÙØ§Ø·Ù…Ø©)     â”‚ fatima@mail.com  â”‚ manager_evaluatedâ”‚ successâ”‚ 2024-12-13  â”‚
â”‚ 39  â”‚ 17 (Ø¹Ù„ÙŠ)       â”‚ ali@mail.com     â”‚ supervisor_eval  â”‚ failureâ”‚ 2024-12-12  â”‚
â”‚     â”‚                â”‚                  â”‚                  â”‚        â”‚ SMTP error  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©
SELECT email_type, status, COUNT(*) as count 
FROM email_logs 
GROUP BY email_type, status;

-- Ø§Ù„Ù†ØªÙŠØ¬Ø©:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email_type           â”‚ status  â”‚ count â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ manager_evaluated    â”‚ success â”‚ 45    â”‚
â”‚ supervisor_evaluated â”‚ success â”‚ 38    â”‚
â”‚ available_any        â”‚ success â”‚ 12    â”‚
â”‚ final_complete       â”‚ success â”‚ 28    â”‚
â”‚ waiting_supervisor   â”‚ success â”‚ 25    â”‚
â”‚ waiting_manager      â”‚ success â”‚ 3     â”‚
â”‚ final_complete       â”‚ failure â”‚ 2     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜

-- Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:
SELECT 
    COUNT(*) as total,
    SUM(IF(status='success', 1, 0)) as success,
    SUM(IF(status='failure', 1, 0)) as failure,
    ROUND(SUM(IF(status='success', 1, 0)) / COUNT(*) * 100, 2) as success_rate
FROM email_logs;

-- Ø§Ù„Ù†ØªÙŠØ¬Ø©:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ total â”‚ success â”‚ failure â”‚ success_rate â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 156   â”‚ 151     â”‚ 5       â”‚ 96.79%       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Ø£Ù…Ø«Ù„Ø© Ù…Ù† Ø§Ù„ÙƒÙˆØ¯

### Ù…Ø«Ø§Ù„ 1: Ø¬Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙŠØ¯ÙˆÙŠÙ‹Ø§

```php
<?php
require_once '../../app/core/db.php';

// Ø¬Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯
$stmt = $pdo->prepare("SELECT value FROM system_settings WHERE `key` = ?");
$stmt->execute(['auto_send_eval']);
$auto_send_eval = $stmt->fetchColumn();

echo "Sending emails? " . ($auto_send_eval ? "YES" : "NO");

// Ø¬Ù„Ø¨ Ø¹Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
$settings = $pdo->query("SELECT `key`, `value` FROM system_settings 
                         WHERE `key` LIKE 'evaluation_email%'")->fetchAll(PDO::FETCH_KEY_PAIR);

foreach($settings as $key => $value) {
    echo "$key = $value\n";
}
?>
```

### Ù…Ø«Ø§Ù„ 2: Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ ÙŠØ¯ÙˆÙŠ

```php
<?php
require_once '../../app/core/db.php';
require_once '../../app/core/Mailer.php';

$mailer = new Mailer($pdo);

// Ø¨Ø±ÙŠØ¯ Ø¨Ø³ÙŠØ·
$sent = $mailer->sendCustomEmail(
    'employee@mail.com',
    'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯',
    'Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¨Ø±ÙŠØ¯',
    '<h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø­Ù…Ø¯</h1><p>Ù†Øµ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù‡Ù†Ø§</p>'
);

if ($sent) {
    echo "âœ“ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­";
} else {
    echo "âœ— ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ - ØªØ­Ù‚Ù‚ Ù…Ù† error_log";
}
?>
```

### Ù…Ø«Ø§Ù„ 3: Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ EmailService

```php
<?php
require_once '../../app/core/db.php';
require_once '../../app/core/EmailService.php';

$emailService = new EmailService($pdo);

// Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚ÙŠÙŠÙ… Ù…Ù† Ù…Ø¯ÙŠØ±
$emailService->handleEvaluationSubmitted(
    $employee_id = 15,      // Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù
    $cycle_id = 3,          // Ù…Ø¹Ø±Ù Ø¯ÙˆØ±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    $evaluator_role = 'manager',  // Ø§Ù„Ø¯ÙˆØ±
    $evaluator_id = 8       // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù‚ÙŠÙ‘Ù…
);

// Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ‚Ø±Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:
// - Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
// - Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
// - Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
// - ÙˆÙŠØ³Ø¬Ù„ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ email_logs
?>
```

### Ù…Ø«Ø§Ù„ 4: Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯

```php
<?php
require_once '../../app/core/db.php';

// Ø¢Ø®Ø± 20 Ø±Ø³Ø§Ù„Ø©
$logs = $pdo->query("
    SELECT 
        l.id,
        l.to_email,
        l.email_type,
        l.status,
        l.error_message,
        l.created_at,
        u.name as employee_name
    FROM email_logs l
    LEFT JOIN users u ON l.employee_id = u.id
    ORDER BY l.created_at DESC
    LIMIT 20
")->fetchAll();

foreach($logs as $log) {
    $status_icon = $log['status'] == 'success' ? 'âœ“' : 'âœ—';
    echo "$status_icon {$log['employee_name']} - {$log['email_type']} - {$log['created_at']}\n";
    if ($log['error_message']) {
        echo "   Ø®Ø·Ø£: {$log['error_message']}\n";
    }
}
?>
```

---

## ğŸ§ª Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

### Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 1: Ø§Ø®ØªØ¨Ø§Ø± SMTP

```php
<?php
require_once '../../app/core/db.php';
require_once '../../app/core/Mailer.php';

// Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø§ØªØµØ§Ù„
try {
    $mailer = new Mailer($pdo);
    
    $result = $mailer->sendCustomEmail(
        'your-email@gmail.com',
        'Ø£Ù†Øª',
        'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯',
        'Ù‡Ø°Ø§ Ø¨Ø±ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±'
    );
    
    if ($result) {
        echo "âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§ØªØµØ§Ù„! ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ.\n";
    } else {
        echo "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ - ØªØ­Ù‚Ù‚ Ù…Ù† error_log\n";
    }
} catch (Exception $e) {
    echo "âŒ Ø®Ø·Ø£: " . $e->getMessage() . "\n";
}
?>
```

### Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± 2: Ù…Ø­Ø§ÙƒØ§Ø© ØªÙ‚ÙŠÙŠÙ… ÙƒØ§Ù…Ù„

```php
<?php
require_once '../../app/core/db.php';
require_once '../../app/core/EmailService.php';

// 1. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¯ÙˆØ±Ø© Ù†Ø´Ø·Ø©
$cycle = $pdo->query("SELECT id FROM evaluation_cycles WHERE status='active' LIMIT 1")->fetch();

if (!$cycle) {
    echo "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø© Ù†Ø´Ø·Ø©\n";
    exit;
}

// 2. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ¸Ù Ù„Ø¯ÙŠÙ‡ Ø±Ø¦ÙŠØ³
$employee = $pdo->query("
    SELECT u.id, u.name 
    FROM users u 
    WHERE supervisor_id IS NOT NULL 
    AND status='active' 
    LIMIT 1
")->fetch();

if (!$employee) {
    echo "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸Ù Ù„Ø¯ÙŠÙ‡ Ø±Ø¦ÙŠØ³\n";
    exit;
}

// 3. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø¯ÙŠØ±
$manager = $pdo->query("SELECT id FROM users WHERE role='manager' LIMIT 1")->fetch();

// 4. Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
$emailService = new EmailService($pdo);

echo "Ù…Ø­Ø§ÙƒØ§Ø©: Ù…ÙˆØ¸Ù {$employee['name']} - Ø¯ÙˆØ±Ø© {$cycle['id']}\n";
echo "Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ€: Ù…Ø¯ÙŠØ± {$manager['id']}\n";

$emailService->handleEvaluationSubmitted(
    $employee['id'],
    $cycle['id'],
    'manager',
    $manager['id']
);

// 5. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„
$logs = $pdo->query("
    SELECT email_type, status 
    FROM email_logs 
    WHERE employee_id = {$employee['id']}
    AND cycle_id = {$cycle['id']}
    ORDER BY created_at DESC 
    LIMIT 1
")->fetch();

if ($logs) {
    echo "âœ“ ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„: {$logs['email_type']} - {$logs['status']}\n";
} else {
    echo "âœ— Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„\n";
}
?>
```

---

## ğŸ“Š Ø£ÙˆØ§Ù…Ø± MySQL Ù…ÙÙŠØ¯Ø©

### Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
```sql
SELECT email_type, error_message, COUNT(*) as count, MAX(created_at) as last_time
FROM email_logs 
WHERE status = 'failure'
GROUP BY email_type, error_message
ORDER BY last_time DESC;
```

### Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙŠÙˆÙ…ÙŠØ©
```sql
SELECT 
    DATE(created_at) as date,
    COUNT(*) as total,
    SUM(IF(status='success', 1, 0)) as success,
    SUM(IF(status='failure', 1, 0)) as failure
FROM email_logs
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

### Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (ØªÙ†Ø¸ÙŠÙ)
```sql
DELETE FROM email_logs 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 90 DAY);
```

---

## ğŸ¬ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰

### 1. ØªØ«Ø¨ÙŠØª ÙˆØ¥Ø¹Ø¯Ø§Ø¯

```bash
# ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØª Composer
composer install

# ØªØ­Ù‚Ù‚ Ù…Ù† vendor/autoload.php Ù…ÙˆØ¬ÙˆØ¯
ls vendor/autoload.php
```

### 2. ØªÙƒÙˆÙŠÙ† SMTP

```
Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: http://yoursite.com/public/admin/email_settings.php

Ø£Ø¯Ø®Ù„:
- SMTP Host: smtp.gmail.com (Ø£Ùˆ Ø®Ø§Ø¯Ù…Ùƒ)
- SMTP Port: 587
- Username: your-email@gmail.com
- Password: your-app-password (Ù„ÙŠØ³Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©!)
- From Email: your-email@gmail.com
- From Name: Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©
- âœ“ ÙØ¹Ù‘Ù„: auto_send_eval
```

### 3. Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„

```
Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: http://yoursite.com/public/admin/bulk_email.php

Ø§Ø®ØªØ±:
- Target: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
- Subject: Ø§Ø®ØªØ¨Ø§Ø±
- Message: Ù‡Ø°Ø§ Ø¨Ø±ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±

Ø§Ø¶ØºØ·: Ø¥Ø±Ø³Ø§Ù„

ØªØ­Ù‚Ù‚ Ù…Ù†: Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
```

### 4. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª

```sql
-- ÙÙŠ phpMyAdmin Ø£Ùˆ terminal
SELECT * FROM email_logs 
ORDER BY created_at DESC 
LIMIT 10;
```

---

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 2024-12-13
